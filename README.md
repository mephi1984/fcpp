# Дипломный проект «Поисковая система»

## Описание
Необходимо написать поисковую систему, аналог Google, Яндекс или Yahoo.

Поисковая система будет получать данные с сайтов, строить поисковые индексы и по запросу выдавать релевантные результаты поисковой выдачи.

Поисковая система будет состоять из следующих частей:
1. Программа-"паук". Это HTTP-клиент, задача которого - парсить сайты и строить индексы, исходя из частоты слов в документах.
2. Программа-поисковик. Это HTTP-сервер, задача которого - принимать запросы и возвращать результаты поиска.

Для хранения информации следует использовать базу данных PostgreSQL.

Настройки программ следует хранить в ini-файле конфигурации.

# Программа "паук"
## Общее описание
Программа "паук" (spider) или "краулер" (crowler) - это неотъемлемая часть поисковой системы. Эта программа, которая обходит Интернет следуя по ссылкам на веб-страницах. Начиная с одной страницы, эта программа переходит на другие страницы по ссылкам, найденным на этих страницах. "Паук" загружает содержимое каждой страницы, а затем индексирует ее.

Изнутри программа-"паук" представляет из себя HTTP-клиент, который переходит по ссылкам, скачивает HTML-страницы и анализирует их содержимое, добавляя записи в базу данных.

## Индексация
После загрузки веб-страницы, производится ее индексация. Для этого в составе программы "паук" существует отдельный модуль Индексатор. Индексатор удаляет HTML-теги из страницы, а затем удаляет все знаки препинания, переносы строк, табуляцию, оставляя только чистый текст. Затем Индексатор анализирует текст на странице и сохраняет информацию в базе данных, для того чтобы вести поиск по этим данным.

Индексатор выполняет следующие действия для страницы:
1. Страница очищается от HTML тегов, от знаков препинания, табуляции, переносов строк и т.д. Остаются только слова, разделенные пробелами.
2. Слова переводятся в нижний регистр - для этого вы можете использовать библиотеку Boost Locale ( https://www.boost.org/doc/libs/1_82_0/libs/locale/doc/html/index.html ). Для простоты можно также отбрасывать все слова короче 3 символов или длиннее 32 символов. 
3. Анализируется частотность слов в тексте. Индексатор считает, сколько раз слово встречается каждое слово в тексте.
4. Информация о словах и о частотности сохраняются в базу данных.

Для хранения информации о частотности слов рекомендуется использовать две таблицы "Документы" и "Слова" и реализовать между ними связь "многие-ко-многим" с помощью промежуточной таблицы. В эту же промежуточную таблицу будет записана частота использования слова в документе. Однако конечное решение о том как хранить данные в базе и какая будет структура базы данных должны принять вы.

## Переход между страницами
В ini-файле конфигурации задается страница, которую необходимо сохранить, и "Паук" начинает свою работу именно с этой страницы.

"Паук" загружает эту страницу и индексирует ее.

В HTML-страницах также существуют ссылки, обозначаемые HTML-тегом `<a href="...">`. "Паук" должен переходить по этим ссылкам и скачивать эти страницы тоже. Для этого "Паук" реализует многопоточную очередь и пул потоков. Очередь состоит из ссылок на скачивание, а пул потоков выполняет задачу по скачиванию веб-страниц с этих ссылок и их индексацию. После скачивания очередной страницы "Паук" собирает все ссылки с этой страницы и добавляет их в очередь на скачивание.

Для сборка ссылок вы можете использовать регулярные выражения, например `"<a href=\"(.*?)\""`. Или вы можете подключить библиотеку для XML-парсинга с поддержкой XPath-запросов, и выполнить поиск по запросу `"//a/@href"`.

"Паук" переходит по страницам не бесконечно. Глубина рекурсии должна быть задана настройкой в ini-файле конфигурации в виде числа. К примеру, если глубина рекурсии задана как 1, то "Паук" анализирует только непосредственно стартовую страницу. Если глубина рекурсии равна 2, то "Паук" анализирует стартовую страницу и страницы, на которые она ссылается. Если глубина рекурсии равна 3, то "Паук", анализирует стартовую страницу, страницы, на которые ссылается стартовая страница, и страницы которые находятся на страницах, на которые стартовая страница, и так далее.

Для реализации HTTP-клиента рекомендуется подключить и использовать библиотеку Boost Beast ( https://www.boost.org/doc/libs/1_82_0/libs/beast/doc/html/index.html ). 

## Программа-поисковик
Программа-поисковик выполняет поиск по базе данных, ранжирует результат и возвращает его пользователю. В настоящих поисковых системах ранжирование выполняется по множеству критериев, однако для простоты будем ранжировать страницу по частоте упоминания искомых слов в документе.

Изнутри поисковик представляет из себя HTTP-сервер, который принимает два вида запросов: POST и GET. Порт, на котором будет запущен HTTP-сервер, должен взят из ini-файла конфигурации.

По запросу GET открывается простая статическая HTML-страница с формой поиска. На форме должно быть поле ввода, а также кнопка поиска.

По запросу POST происходит извлечение из базы данных результата запроса и его ранжирование, а затем перед пользователем открывается простая статическая веб-страница с результатами поиска.

Для простоты, запрос можно анализировать только в виде слов, разделенных пробелами. Все прочие знаки препинания игнорируются. Можно также ограничить длину запроса - не более 4х слов. 

Для извлечения данных напишите SQL-запрос. Запрос должен быть следующим: взять документы, в которых встречаются все слова из запроса и отсортировать документы по суммарному количеству упоминаний слов в документа.

Приведу пример для запроса "привет мир". Предположим, если если в документе A слово "привет" встречается 10 раз, а слово "мир" встречается 4 раза, то этот документ имеет релевантность 10 + 4 = 14. Если в документе B слово "привет" встречается 3 раза, а слово "мир" 8 раза, то релевантность его равна 3 + 8 = 11, и он будет находится ниже в выдаче.

Для простоты можете ограничить выдачу, выдавая не более чем 10 результатов поиска.

Полсе выполнения запроса программа должна вернуть статическую HTML-страницу с результатами поиска - ссылками на веб-страницы. Результаты должны быть отсортированы по убыванию.

В случае если результатов не найдено, на HTML-странице следует отобразить соответствующее сообщение.

В случае если при работе программы возникла ошибка, на HTML-странице

Для реализации HTTP-сервера рекомендуется подключить и использовать библиотеку Boost Beast ( https://www.boost.org/doc/libs/1_82_0/libs/beast/doc/html/index.html ). 

## База данных
Для выполнения задания рекомендуется использовать базу данных PostgreSQL.

Для подключения к базе данных рекомендуется использовать библиотеку `libpqxx`.

Настройки базы данных (хост, порт, название БД, имя пользователя, пароль) следует хранить в ini-файле конфигурации.

При первом запуске программы-"паука" следует выполнить создание таблиц базы данных, используя запрос `CREATE TABLE IF NOT EXISTS`.

## Файл конфигурации ini
Все настройки программ следует хранить в ini-файле. Этот файл должен парсится при запуске вашей программы.

В этом файле следует хранить следующие параметры:
1. Хост (адрес) базы данных.
2. Порт, на котором запущена база данных.
3. Название базы данных.
4. Имя пользователя для подключения к базе данных.
5. Пароль пользователя для подключения к базе данных.
6. Стартовая страница для программы-"паука".
7. Глубина рекурсии для программы-"паука".
8. Порт для запуска программы-поисковика.

## Что является итогом работы
* Репозиторий на GitHub с исходным кодом вашего проекта и ini-файлом конфигурации.

## Критерии сдачи
* Выполнены минимальные требования к работе.
* Приложение полностью функционирует (нет логически недоделанных частей, заглушек, TODO и т.д.).
* Нет явных изъянов в архитектуре, "плохо пахнущего кода", проблем с многопочностью, утечек памяти, не отловленных исключений и т.д.

## Полезные материалы
* [Пример HTTP-клиента на Boost Beast](https://www.boost.org/doc/libs/1_82_0/libs/beast/doc/html/beast/quick_start/http_client.html)
* [Пример HTTP-сервера на Boost Beast](https://www.boost.org/doc/libs/1_82_0/libs/beast/examplez/http/server/small/http_server_small.cpp)
* [Пример использования Boost Locale для перевода строк в другой регистр](https://www.boost.org/doc/libs/1_82_0/libs/locale/doc/html/hello_8cpp-example.html)
* [Пример поиска с помощью регулярных выражений в C++](https://en.cppreference.com/w/cpp/regex)
* [Пример использования XPath-запроса для парсинга XML с помощью библиотеки pugixml](https://pugixml.org/docs/samples/xpath_query.cpp)
